import{i as N}from"./vue-CSDdYaJw.js";import{d as S,h as _,l as j,m as B,o as n,i as d,w as m,b as r,g,u as L,x as k,n as z,c as a,F as A,r as E,t as I}from"./index-B1cQ-YdH.js";const M=""+new URL("cluster4-DPepexmu.png",import.meta.url).href,R={key:0},b=["onClick"],U={key:1},J=S({__name:"index",setup(V){const h={zoom:8,center:[118.12582777425764,24.637526109241485]},C={icon:{src:N,scale:.6}},x={icon:{src:M}},u=_(),t=j({cluster:!1,list:[],info:{device_code:"",NAME:""},position:void 0});let f=_();const w=(o,e)=>{var s;if(e)if(t.cluster=e.get("cluster"),t.cluster){t.list=[];const l=e.get("cluster_id");if(e.get("point_count")<=10){const c=(s=f.value)==null?void 0:s.getLeaves(l,1/0);c&&(t.list=c.map(p=>p.properties))}t.position=e.get("coordinates")||o.coordinate}else t.info=e.get("properties"),t.position=e.get("coordinates")||o.coordinate},F=o=>{var s;const e=(s=u.value)==null?void 0:s.features.find(l=>l.properties.device_code===o);e&&(t.info=e.properties,t.cluster=!1)};let v=_(!1);const D=()=>{let o=[];fetch("http://172.16.34.132:8222/geoserver/test/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=test:camera_30w&outputFormat=application/json&maxFeatures=20000").then(e=>e.json()).then(e=>{o=e.features,u.value={type:"FeatureCollection",features:o},v.value=!0})};return B(()=>{D()}),(o,e)=>{const s=r("ol-tile"),l=r("ol-feature"),y=r("ol-cluster"),c=r("ol-overlay"),p=r("ol-map");return n(),d(p,{view:h,onDblclick:e[0]||(e[0]=i=>t.position=void 0)},{default:m(()=>[g(s,{"tile-type":"BAIDU"}),L(v)?(n(),d(y,{key:0,"z-index":2,"class-name":"layer-cluster","layer-style":C,"cluster-style":x,"super-cluster":{radius:120},onSingleclick:w},{default:m(()=>[g(l,{ref_key:"clusterRef",ref:f,"geo-json":u.value},null,8,["geo-json"])]),_:1})):k("",!0),t.cluster?(n(),d(c,{key:1,class:z(["overlay","overlay-cluster"]),position:t.position},{default:m(()=>[t.list.length>0?(n(),a("ul",R,[(n(!0),a(A,null,E(t.list,i=>(n(),a("li",{key:i.device_code,onClick:$=>F(i.device_code)},I(i.NAME),9,b))),128))])):(n(),a("span",U,"尝试点击聚合数≤10的点，显示聚合点位列表"))]),_:1},8,["position"])):k("",!0)]),_:1})}}});export{J as default};
